<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta content="width=device-width, initial-scale=1" name="viewport">

        <!--
        The above 3 meta tags *must* come first in the head;
        any other head content must come *after* these tags
        -->

        <title>
            Tinkerforge WIFI Extension 2.0
        </title>

        <style type="text/css">
            /* embed:./css/combined.css */
        </style>
    </head>
    <body class="hidden">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">
                        <img alt="Brand" src="data:image/png;base64,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">
                        <b>WIFI Extension 2.0</b>
                    </a>
                </div>
            </div>
            <!-- /.container-fluid -->
        </nav>

        <div aria-labelledby="modal_submit"
        class="modal fade bs-example-modal-lg"
        data-backdrop="static" id="modal_submit"
        role="dialog" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        Authenticating...
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div id="alert_error" class="alert alert-danger hidden" role="alert">
                <strong>Error!</strong> Failed to authenticate. Please check your secret.
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <b>Authentication</b>
                    </h3>
                </div>

                <div class="panel-body">
                    <form id="form_authenticate" class="form-horizontal" role="form" 
                    action="/authenticate.cgi" method="post">
                        <div class="form-group row">
                            <label class="col-sm-4 control-label" for="common_port">
                                Secret:
                            </label>
                            <div class="col-sm-6">
                                <input id="secret" class="form-control" name="secret"
                                placeholder="Authentication secret" type="password" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-offset-4 col-sm-6">
                                <div class="checkbox">
                                    <label>
                                        <input id="input_checkbox_show_hide_characters_secret"
                                        type="checkbox" />
                                            Show Characters
                                    </label>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
            <button id="submit" type="button" class="btn btn-block spacer-bottom"
            data-target="#modal_submit" data-toggle="modal" disabled>
                Authenticate
            </button>
                    </form>
        </div>

        <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/javascript">
            // embed:./js/combined.js
        </script>

        <script type="text/javascript">
            $(document).ready(function() {
                $.ajax({
                    type: 'POST',
                    url: '/is_already_authenticated.cgi',
                    data: null,
                    //dataType: "json",
                    timeout: 16000, // in milliseconds
                    success: function(data) {
                        // process data here
                        console.log('*** success(), data = ' + data);

                        var o= JSON.parse(data);
                        if(o.status === 1) {
                            console.log('*** cookie = ' + document.cookie);
                            //$(window).attr('location', window.location.protocol+'//'+window.location.hostname+'/index.html');
                            //$(location).attr('href', window.location.protocol+'//'+window.location.hostname+'/index.html');
                            //$(location).prop('href', window.location.protocol+'//'+window.location.hostname+'/index.html');
                            window.location.replace(window.location.protocol+'//'+window.location.hostname);
                            //window.location.href = window.location.protocol+'//'+window.location.hostname+'/';
                            //window.location = window.location.protocol+'//'+window.location.hostname+'/';
                            //setTimeout(function(){

                            //}, 2000);
                        }
                        else {
                            // Show the body of the page only when the whole page is ready.
                            $("body").toggleClass('hidden show');
                        }
                    },
                    error: function(request, status, err) {
                        console.log('*** error()');
                        console.log(request);
                        console.log(status);
                        console.log(err);

                        $("#modal_submit").modal('hide');
                        $("#alert_error").removeClass('hidden');
                        $("#alert_error").show();
                    }
                });

                // Clear all alerts.
                $("#alert_error").hide();

                // Secret field's keyup event handler.
                $("#secret").keyup(function() {
                    if($( "#secret" ).val().length < 1)
                        $('#submit').prop('disabled', true);
                    else
                        $('#submit').prop('disabled', false);
                });

                /*
                 * Clear all alerts when authenticate modal is shown.
                 * This implies a new submit.
                 */
                $("#modal_submit").on('show.bs.modal', function () {
                    $("#alert_error").addClass('hidden');
                    $("#alert_error").hide();
                });

                // Show/hide characters.
                $('#input_checkbox_show_hide_characters_secret').change(function(){
                    if(this.checked) {
                        $('#secret').attr("type", "text");
                    }
                    else {
                        $('#secret').attr("type", "password");
                    }
                });

                // After the modal is already being shown event handler.
                $("#modal_submit").on('shown.bs.modal', function () {
                    // Submit the form here.

                    console.log($("#form_authenticate").serialize());

                    $.ajax({
                        type: 'POST',
                        url: '/authenticate.cgi',
                        data: $("#form_authenticate").serialize(),
                        //dataType: "json",
                        timeout: 16000, // in milliseconds
                        success: function(data) {
                            // process data here
                            console.log('*** success(), data = ' + data);

                            var o= JSON.parse(data);
                            if(o.status === 1) {
                                console.log('*** cookie = ' + document.cookie);
                                //$(window).attr('location', window.location.protocol+'//'+window.location.hostname+'/index.html');
                                //$(location).attr('href', window.location.protocol+'//'+window.location.hostname+'/index.html');
                                //$(location).prop('href', window.location.protocol+'//'+window.location.hostname+'/index.html');
                                window.location.replace(window.location.protocol+'//'+window.location.hostname);
                                //window.location.href = window.location.protocol+'//'+window.location.hostname+'/';
                                //window.location = window.location.protocol+'//'+window.location.hostname+'/';
                                //setTimeout(function(){

                                //}, 2000);
                            }
                            else {
                                $("#modal_submit").modal('hide');
                                $("#alert_error").removeClass('hidden');
                                $("#alert_error").show();
                            }
                        },
                        error: function(request, status, err) {
                            console.log('*** error()');
                            console.log(request);
                            console.log(status);
                            console.log(err);

                            $("#modal_submit").modal('hide');
                            $("#alert_error").removeClass('hidden');
                            $("#alert_error").show();
                        }
                    });

                    console.log('show event fired!, secret = ' + $("#secret").val());
                });
            });
        </script>
    </body>
</html>
